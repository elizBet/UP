var articles = [
    {
        id: '1',
        title: 'Медведь проснулся!',
        summary: 'Он очнулся после зимней спячки. Это означает, что пришла настоящая весна',
        createdAt: new Date('2018-02-27T23:00:00'),
        author: 'Иванов Иван',
        content: 'О том, что весна будет ранней, заявляют в Могилёвском зоосаду. И верный признак – то, что медведь Фёдор уже проснулся после зимней спячки. Косолапый синоптик ещё ни разу не ошибался в своих прогнозах.'+
        'В дикой природе медведи впадают в спячку из-за нехватки еды. В неволе такой проблемы у животного нет, но инстинкт берёт своё. После пробуждения у восьмилетнего бурого медведя – повышенный аппетит. В меню – рыба, мясо,'+
        'различные каши на гарнир, а также фрукты и печенье. Любимое лакомство Фёдора – тосты из белого хлеба с медом. Учащиеся местного колледжа, на территории которого находится зоосад, всячески балуют своего питомца.'+
        'Александр Куропаткин, учащийся Могилёвского государственного профессионального агролесотехнического колледжа: «Наш медведь Фёдор в зимний сон впал перед Новым годом. Просыпался несколько раз, но из-за перемены погоды снова'+
        'засыпал. Сейчас он проснулся окончательно, бодрый, хороший аппетит – весна пришла».'+
        'Другие обитатели зоосада также отреагировали на приближение весны: у зайцев сменился окрас шубки, у лосей и косуль начали отрастать рога.',
        tags: ['медведь','зима','весна']
    },
    {
        id: '2',
        title: 'Две стюардессы получили условные сроки за фото спящего пилота',
        summary: 'Девушки хотели наказать нерадивого коллегу, но он подал иск в суд о вмешательстве в личную жизнь и выиграл дело.',
        createdAt: new Date('2019-02-27T23:00:00'),
        author: 'Иван',
        content: 'Два стюардессы одной из эмиратских авиакомпаний получили условные сроки по 6 месяцев каждая за то, что сделали фотографии спящего во время полета коллеги без его ведома, сообщает издание Khaleej Times.'+
        'Стюардессы во время рейса из Абу-Даби в Южную Африку сделали фото спящего коллеги и показали его руководству компании, после чего мужчина был уволен за неисполнение своих обязанностей.'+
        'Обиженный пилот подал ответный иск о нарушении его частной жизни. Суд признал женщин виновных в том, что они нарушили частную жизнь их коллеги и приговорил к полугоду заключения каждую. Однако апелляционный суд Абу-Даби заменил реальные сроки на условные.',
        tags: ['пилот','самолет','стюардессы']
    },
    {
        id: '3',
        title: 'Facebook будет выявлять склонных к суициду пользователей',
        summary: 'Соцсеть Facebook будет находить склонных к суициду пользователей с помощью искусственного интеллекта. Об этом сообщает BBC.',
        createdAt: new Date('2017-02-27T23:00:00'),
        author:'Иван',
        content:'Разработчики Facebook создали алгоритмы, которые отслеживают тревожные фразы в сообщениях или комментариях. Технология искусственного интеллекта будет искать в текстах упоминания о боли, страданиях, депрессии. Полученные данные будут отправляться исследователям,'+
        'которые будут решать, нужна ли человеку помощь. Создатель данного проекта считает, что это необходимая мера. Нововведение будет действовать пока только на территории США.'+
        'С компанией сотрудничают организации, оказывающие психологическую помощь. Они смогут связываться с пользователями, склонными к суициду, и помогать им.',
        tags:['facebook','социальные сети','суицид']
     },
     {
        id: '4',
        title: 'В Израиле декриминализовали употребление марихуаны',
        summary: 'Правительство Израиля утвердило предложение о декриминализации употребления марихуаны. Об этом 5 марта сообщает Jerusalem Post.',
        createdAt: new Date('2017-02-27T23:00:00'),
        author:'Ольга',
        content:'По новым правилам, впервые пойманный потребитель отделается штрафом вместо тюремного срока. В случае, если он попадется повторно, сумма выплаты удвоится. На третий раз нарушителя могут отправить на реабилитацию, а также лишат водительских прав или лицензии на право владения оружием.'+
        'Уголовное дело может быть возбуждено в том случае, если нарушитель попадется в четвертый раз.'+
        'Как уточняет «Русская служба Би-би-си», сумма первоначального штрафа составит 270 долларов. При этом Израиль стал первым государством на Ближнем Востоке, где декриминализовано употребление каннабиса. Эта страна является мировым лидером в области изучения применения марихуаны в медицинских целях.'+
        'Согласно официальным данным израильского Минздрава, около 25 тысяч человек в стране имеют право на получение медицинской марихуаны. Многие из них страдают онкологическими или психическими заболеваниями.',
        tags:['Израиль','марихуана','закон']
      },
      {
        id: '5',
        title: 'Мужчина закопал себя заживо на три дня, чтобы собрать средства для наркоманов',
        summary: 'Житель Северной Ирландии Джон Эдвардс на три дня переехал в гроб, чтобы собрать денег на благотворительность.',
        createdAt: new Date('2017-02-27T23:00:00'),
        author:'Карина',
        content:'Как сообщается, основатель благотворительной организации Walking Free, которая помогает людям, страдающим от депрессии и вредных привычек, необычно «похоронил» себя рядом с одной из церквей Белфаста. В гроб Эдвардса проведена вентиляция. Также там есть беспроводной интернет. Кроме того, габариты гроба позволяют мужчине сидеть. Житель Белфаста на три дня лег в гроб ради благотворительности Как стало известно uznayvse.ru, прямо из своей «могилы» Эдвардс общается по сети с наркоманами и алкоголиками. Мужчина в шутку отметил, что хочет поговорить с ними из гроба, пока они сами в него не легли.',
        tags:['благотворительность','Ирландия','похороненный заживо']
      },
      {
        id: '6',
        title: 'Помогает ли предпринимательский опыт президенту Трампу',
        summary: '«США нужно управлять, как будто это огромная корпорация», — с этими словами Дональд Трамп шел на президентские выборы. Во время избирательной кампании Трамп позиционировал себя как крайне успешного предпринимателя, умеющего заключать хорошие сделки. Однако первые же его недели в Белом доме показали, что эту стратегию необходимо скорректировать.',
        createdAt: new Date('2017-02-27T23:00:00'),
        author:'Екатерина',
        content:'«Организация Трампа — это диктатура, а не демократия», — так в 2004 году говорил Джордж Росс, исполнительный вице-президент и советник миллиардера в интервью NY Daily News. «Он напористый, агрессивный, не стесняется в выражениях», — характеризовал своего отца Дональд Трамп-младший. «Люди правят, используя разные методы. Вы можете добиться того, чтобы вас боялись, можете — чтобы вас уважали, но как противники, так и друзья должны знать, что вами нельзя помыкать. Если у них получится, боссом будете не вы, а они», — писал сам бизнесмен в книге The Art of the Comeback («Искусство возвращения»).'+
        ' критики, и сторонники Трампа сходятся в одном — его личность, присущие ему непосредственность, нарциссизм и нежелание играть по устоявшимся правилам помогли ему добиться успеха как в бизнесе, так и в политике.',
        tags:['Трамп','США']
      }
];
var tags = ["Россия","Нью-Йоркер","масленица","ЖД","ПВТ","Брест","весна","пиво","германия","оскар","конфуз",
    "ужастик","кино","граффити","одежда","Минск","авария","пробки","дождь","Минск","Трамп","США",
    "благотворительность","Ирландия","похороненный заживо","Израиль","марихуана","закон","facebook",
    "социальные сети","суицид","пилот","самолет","стюардессы","медведь","зима","весна"]

function getArticle(id) {
    if (id === undefined) {
        return undefined;
    } 
    else {
        for (var i = 0; i < articles.length; i++) {
            if (articles[i].id == id) {
                return articles[i];
            }

        }
    }
}
function getArticles(skip, top, filterConfiguration) {
    skip = skip || 0;
    top = top || 19;

    if (filterConfiguration !== undefined) {
        var author = filterConfiguration.author || "";
        var dateFrom = filterConfiguration.dateFrom || new Date(-8640000000000000);
        var dateTo = filterConfiguration.dateTo || new Date(8640000000000000);
        var _tags = filterConfiguration.tags || [];
    }

    var _articles = articles;

    if (filterConfiguration !== undefined) {
        _articles = _articles.filter(function (article) {
            if (article.author.indexOf(author) > -1) {
                return true;
            } else {
                return false;
            }
        });

        _articles = _articles.filter(function (article) {
            if (article.createdAt >= dateFrom && article.createdAt <= dateTo) {
                return true;
            } else {
                return false;
            }
        });
    }

    if (_tags !== undefined) {
        _articles = _articles.filter(function (article) {
            var count = 0;
            for (var i = 0; i < article.tags.length; i++) {
                for (var j = 0; j < _tags.length; j++) {
                    if (article.tags[i] === _tags[j]) {
                        count++;
                    }
                }
            }
            if (count === _tags.length) {
                return true;
            }
            return false;
        });
    }

    _articles = _articles.slice(skip, skip + top);

    articles.sort(compareDate);

    return _articles;
}

function getArticle(id) {
    if (id === undefined) {
        return undefined;
    } else {
        for (var i = 0; i < articles.length; i++) {
            if (articles[i].id == id) {
                return articles[i];
            }

        }
    }
}

function validateTags(_tags, tags) {
    for (var i = 0; i < _tags.length; i++) {
        if (tags.indexOf(_tags[i]) < 0) {
            return false;
        }
    }
    return true;
}

function validateArticle(article) {
    if (
        typeof article.id === "string" && article.id.length > 0 && getArticle(article.id) === undefined &&
        typeof article.title === "string" && article.title.length > 0 && article.title.length < 100 &&
        typeof article.summary === "string" && article.summary.length > 0 && article.summary.length < 200 &&
        article.createdAt instanceof(Date) &&
        typeof article.author === "string" && article.author.length > 0 &&
        typeof article.content === "string" && article.content.length > 0 &&
        article.tags !== undefined && article.tags.length > 0 && validateTags(article.tags, tags)) {
        return true;
    } else {
        return false;
    }
}

function addArticle(article, tags) {
    if (!validateArticle(article, tags)) {
        return false;
    }
    articles.push(article);
    return true;
}

function editArticle(id, article) {
    var _article = getArticle(id);

    if (article.title !== undefined) {
        _article.title = article.title;
    }
    if (article.summary !== undefined) {
        _article.summary = article.summary;
    }
    if (article.content !== undefined) {
        _article.content = article.content;
    }
    if (article.imageSource !== undefined) {
        _article.imageSource = article.imageSource;
    }
    if (article.tags !== undefined) {
        _article.tags = article.tags;
    }

    if (validateArticleForEdition(_article)) {
        article.title = _article.title;
        article.summary = _article.summary;
        article.content = _article.content;
        article.imageSource = _article.imageSource;
        article.tags = _article.tags;
        return true;
    } else {
        return false;
    }
}

function validateArticleForEdition(article) {
    if (
        typeof article.id === "string" && article.id.length > 0 &&
        typeof article.title === "string" && article.title.length > 0 && article.title.length < 100 &&
        typeof article.summary === "string" && article.summary.length > 0 && article.summary.length < 200 &&
        article.createdAt instanceof(Date) &&
        typeof article.author === "string" && article.author.length > 0 &&
        typeof article.content === "string" && article.content.length > 0 &&
        article.tags !== undefined && article.tags.length > 0 && validateTags(article.tags, tags)) {
        return true;
    } else {
        return false;
    }
}

function removeArticle(id) {
    for (var i = 0; i < articles.length; i++) {
        if (articles[i].id == id) {
            articles.splice(i, 1);
            return true;
        }
    }
    return false;
}

function addTag(tag) {
    if (tags.indexOf(tag.toLowerCase()) < 0) {
        tags.push(tag.toLowerCase());
        return true;
    } else {
        return false;
    }
}

function removeTag(tag) {
    var tagIndex = tags.indexOf(tag.toLowerCase());
    if (tagIndex >= 0) {
        tags.splice(tagIndex, 1);
        return true;
    } else {
        return false;
    }
}

function getArticle(id) {
    if (id === undefined) {
        return undefined;
    } else {
        for (var i = 0; i < articles.length; i++) {
            if (articles[i].id == id) {
                return articles[i];
            }

        }
    }
}
function compareDate(article1, article2) {
    if (article1.createdAt - article2.createdAt < 0) {
        return 1;
    } else {
        return -1;
    }
}
console.log("Статьи с заданным именем:");
console.log(getArticles(0, 5, {
    author: "Иван"
}));
console.log("Статьи с 2-4");
console.log(getArticles(1, 3));
console.log("\n");

console.log("Статьи с заданными тегами");
console.log(getArticles(0, 5,{tags :["Израиль"]}));
console.log("\n");

console.log("Статьи в заданном временном промежутке");
console.log(getArticles(0, 5, {
    dateFrom: new Date("2005-02-05T00:00:00"),
    dateTo: new Date("2018-02-06T23:59:59"),
}));
console.log("\n");
 
console.log("Статьи по id");
console.log(getArticle("2"));
console.log("\n");
